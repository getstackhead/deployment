resource "nginx_server_block" "{{ resource_name }}" {
  filename = "{{ resource_name }}.conf"
  enable = true

  content = <<EOF
{%- for nginx_vhost in nginx_vhosts %}
{{ lookup('template', "{{ stackhead__templates }}/nginx/serverblock.http.j2") }}
{{ lookup('template', "{{ stackhead__templates }}/nginx/serverblock.native-https.j2") }}
{%- endfor %}
EOF

  provisioner "local-exec" {
    command = "sudo systemctl reload nginx"
  }
}