node default {
  class { 'stackhead':
    acme_dir => '{{ stackhead__acme_folder }}',
    certificate_dir => '{{ stackhead__certificates_folder }}',
    project_certificate_dir => '{{ stackhead__certificates_project_folder }}',
    letsencrypt_certificate_dir => '{{ letsencrypt_certificate_folder }}',
    certificate_email => 'certificate@saitho.me',
    htpasswd_path => '{{ nginx_htpasswd_path }}',
    test => {% if lookup('env', 'TEST') == 1 %}true{% else %}false{% endif %},
  }

  stackhead::project::container { '{{ project_name }}':
    ensure => '{{ ensure }}',
    domains => {{ app_config.domains|to_ruby_hash }},
    services => {{ containerapp__services|to_ruby_hash }}
  }

}